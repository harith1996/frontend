{"ast":null,"code":"import { Observable, Subject } from 'rxjs';\nimport { share } from 'rxjs/operators';\nimport { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let DataService = /*#__PURE__*/(() => {\n  class DataService {\n    constructor(_http) {\n      this._http = _http;\n      /* API routes */\n\n      this.API_GET_INFO = environment.rest_proto + environment.api_url + \"info\";\n      this.API_GET_TEMPERATURE = environment.rest_proto + environment.api_url + \"temperature\";\n      this.API_GET_HUMIDITY = environment.rest_proto + environment.api_url + \"humidity\";\n      this.API_GET_DISTANCE = environment.rest_proto + environment.api_url + \"distance\";\n      this.API_GET_LED = environment.rest_proto + environment.api_url + \"led\";\n\n      this.API_SET_LED = s => environment.rest_proto + environment.api_url + \"led/\" + s;\n\n      this.WS_URL = environment.ws_proto + environment.api_url;\n    }\n    /**\n     * Uses HttpClient to retrieve info about the server.\n     * @returns an Observable to the /api/info route. Right now it\n     * only returns the update rate of the sensors.\n     */\n\n\n    getInfo() {\n      return this._http.get(this.API_GET_INFO);\n    }\n    /**\n     * Uses HttpClient to retrieve historical data about the temperature.\n     * @returns an Observable to the /api/temperature route.\n     */\n\n\n    getTemperature() {\n      return this._http.get(this.API_GET_TEMPERATURE);\n    }\n    /**\n     * Uses HttpClient to retrieve historical data about the humidity.\n     * @returns an Observable to the /api/humidity route.\n     */\n\n\n    getHumidity() {\n      return this._http.get(this.API_GET_HUMIDITY);\n    }\n    /**\n     * Uses HttpClient to retrieve historical data about the ultrasonic sensor.\n     * @returns an Observable to the /api/distance route.\n     */\n\n\n    getDistance() {\n      return this._http.get(this.API_GET_DISTANCE);\n    }\n    /**\n     * Uses HttpClient to retrieve the current status of the LED.\n     * @returns an Observable to the /api/led route.\n     */\n\n\n    getLED() {\n      return this._http.get(this.API_GET_LED);\n    }\n    /**\n     * Uses HttpClient to set the current status of the LED.\n     * @param s State of the LED, 0 to turn off and 1 to turn on.\n     * @returns an Observable to the /api/led/{0,1} route.\n     */\n\n\n    setLED(s) {\n      return this._http.get(this.API_SET_LED(s), {\n        responseType: 'text'\n      });\n    }\n    /**\n     * Initializes the WebSocket Subject and shared Observable.\n     */\n\n\n    connectWebSocket() {\n      // If the WebSocket is already initalized,\n      // get out of here.\n      if (this.webSocketSubject) {\n        return;\n      } // Connect the WebSocket to the correct URL\n\n\n      let ws = new WebSocket(this.WS_URL); // Create an Observable for the WebSocket\n\n      let observable = Observable.create(obs => {\n        ws.onmessage = obs.next.bind(obs);\n        ws.onerror = obs.error.bind(obs);\n        ws.onclose = obs.complete.bind(obs);\n        return ws.close.bind(ws);\n      });\n      let observer = {\n        next: data => {\n          if (ws.readyState === WebSocket.OPEN) {\n            ws.send(JSON.stringify(data));\n          }\n        }\n      }; // Assign the created Observable to the WebSocket Subject\n\n      this.webSocketSubject = Subject.create(observer, observable); // Create a shared Observable to share across all views\n\n      this.sharedObservable = this.webSocketSubject.pipe(share());\n    }\n    /**\n     * Get a shared Observable to the WebSocket.\n     * @returns a shared Observable to the active WebSocket.\n     */\n\n\n    getWebSocket() {\n      return this.sharedObservable;\n    }\n\n  }\n\n  DataService.ɵfac = function DataService_Factory(t) {\n    return new (t || DataService)(i0.ɵɵinject(i1.HttpClient));\n  };\n\n  DataService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: DataService,\n    factory: DataService.ɵfac,\n    providedIn: 'root'\n  });\n  return DataService;\n})();","map":null,"metadata":{},"sourceType":"module"}